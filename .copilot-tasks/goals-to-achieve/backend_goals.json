{
  "backend_goals": [
    {
      "id": "backend_core_scope",
      "title": "Crew-7 Backend â€” Core Responsibilities",
      "copilot_prompt": "Backend scope for Crew-7.\n\nThe backend must:\n1) Provide REST + SSE + WebSocket APIs for crews, runs, traces, tools, marketplace, LLM connections, environment variables, and workspace/org management.\n2) Execute multi-agent systems using CrewAI (or equivalent) with full run lifecycle management: queued, running, succeeded, failed.\n3) Produce granular run events (agent_start, agent_end, tool_call, tool_result, edge/messages) and stream them in real time.\n4) Enforce strict sandboxing for tools (git, pytest, bash, file ops, GitHub PR) via docker or subprocess limits.\n5) Store artifacts, run logs, and trace history; support pagination and filtering.\n6) Support per-org secret storage (LLM keys, environment variables) with encryption and masked read access.\n7) Be multi-tenant safe: no cross-org leakage, no unbounded resources.\n8) Keep APIs predictable and stable; prefer additive changes.\n\nThe backend must NOT:\n- Become a monolithic code generator.\n- Store raw secrets.\n- Execute unbounded or unsafe shell commands.\n- Handle frontend presentation logic.\n\nCopilot: When modifying backend code, verify the change fits these rules. Reject or warn if a task tries to violate them."
    },
    {
      "id": "backend_runs_and_traces",
      "title": "Runs, Traces & Events",
      "copilot_prompt": "Backend runs + traces goals:\n1) A run must always create a Run record and a TraceBatch.\n2) Every agent action must produce trace events: agent_start, agent_token, agent_end.\n3) All tool executions must be captured as tool_call + tool_result.\n4) WebSocket /ws/graph must broadcast events to the frontend in JSON format.\n5) API must allow pause/resume/cancel at any time.\n6) Storing run artifacts must be safe and limited.\n\nWhen editing run, trace, or websocket code: match this contract. Ensure no missing lifecycle event."
    },
    {
      "id": "backend_marketplace",
      "title": "Marketplace and Crew Templates",
      "copilot_prompt": "Marketplace backend rules:\n1) Templates define crews (nodes, tools, prompts) and install into the user's workspace.\n2) Installation must be idempotent and must never overwrite user crews.\n3) Installed template becomes a normal crew with its own ID, memory, and graph.\n4) Templates stored as JSON + metadata.\n\nCopilot: When working on marketplace endpoints, never mix template definitions with run-time crew state."
    },
    {
      "id": "backend_env_and_llm",
      "title": "LLM Connections & Env Vars",
      "copilot_prompt": "Backend environment + LLM scope:\n1) Store API keys encrypted; show masked on read.\n2) LLM providers: OpenAI-compatible, Ollama, Anthropic (future).\n3) Inject env vars per run and per crew.\n4) Never persist plaintext secrets in logs or DB.\n\nCopilot: Enforce these constraints in all new code."
    },
    {
      "id": "backend_security_limits",
      "title": "Sandbox & Security Rules",
      "copilot_prompt": "Security/sandbox rules:\n1) All tool executions must be CPU, RAM, and time limited.\n2) Tool processes must be isolated from host.\n3) Network access must be restricted except allowed destinations (GitHub if needed).\n4) Do not execute arbitrary user code without sandbox.\n5) Validate all inputs from frontend.\n\nCopilot: Warn if a change violates these guardrails."
    }
  ]
}
